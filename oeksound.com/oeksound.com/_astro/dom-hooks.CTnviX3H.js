import{c as l,a as p}from"./solid.FlMzgGMJ.js";import{o as y,f as d}from"./utils.DmsN6_Oz.js";let f;const u=new Promise(a=>{f=a}),[S,g]=l(!1),[o,b]=l([]),[s,h]=l(null);function C(a){const t=Array.from(document.querySelectorAll("[data-product-price]"));for(const n of t){const e=a.find(i=>i.pid===n.getAttribute("data-product-price"));e&&(e.discountTotalValue>0?n.innerHTML='<span class="strike-through text-muted fw-normal">'.concat(d(e.price),'</span> <span class="fw-medium" style="color: var(--form-color);">').concat(d(e.unitPrice),"</span>"):n.textContent=d(e.unitPrice))}}function v(a){var t,n,e,i;window.dataLayer.push({event:"add_to_cart"}),"fbq"in window&&fbq("trackCustom","AddToCart",{content_type:"product",content_ids:[(n=(t=o().find(m=>m.pid===a))==null?void 0:t.attributes)==null?void 0:n.fbProductGroupId],value:(e=s())==null?void 0:e.totalValue,currency:(i=s())==null?void 0:i.currency})}const L=async a=>{const t=await u;await new Promise(n=>{t.builder.add(a,n)}),v(a)};let r,c;function w(){if(!r){r=document.createElement("p"),c=document.createElement("span");const a=document.createElement("span");a.classList.add("fw-bold"),a.textContent=" Click to dismiss.",a.addEventListener("click",()=>{r.classList.add("d-none")}),r.appendChild(c),r.appendChild(a),r.setAttribute("class","alert-danger position-fixed fastspring-hotfix")}return r}const P=async()=>{var a;if(((a=s())==null?void 0:a.country)==="CN"){const t=w();document.body.appendChild(t),t.classList.remove("d-none"),c.innerHTML="Unfortunately our retailer FastSpring is experiencing delays with Alipay. If you purchase with Alipay, your order will be delivered with a delay. Please consider using a different payment method."}(await u).builder.checkout(),"fbq"in window&&fbq("trackCustom","InitiateCheckout",{content_type:"product",num_items:o().filter(t=>t.selected).length,content_ids:o().filter(t=>t.selected&&t.attributes).map(t=>t.attributes.fbProductGroupId)})};if(globalThis.document){p(()=>{C(o())}),window.fastSpringDataCallback=t=>{const n=t.groups.reduce((e,i)=>[...e,...i.items],[]);h(t),b(n),window.dataLayer=window.dataLayer||[],window.dataLayer.push({currency:t.currency,country:t.country,total_value:t.totalValue,products:n.filter(e=>e.selected).map(e=>({item_id:e.pid,item_name:e.display,quantity:e.quantity}))})},window.cartState&&setTimeout(()=>{window.fastSpringDataCallback(window.cartState),window.cartState=null},100),window.fastSpringErrorCallback=t=>{console.error(t)},window.fastSpringDecorateCallback=t=>{let n=null;return typeof window.ga=="function"&&window.ga&&window.ga(()=>{n=ga.getAll()[0].get("linkerParam")}),n?"".concat(t,"?").concat(n):t},window.fastSpringWebhookReceivedCallback=async t=>{localStorage.setItem("orderData",JSON.stringify({orderData:t,orderTime:Date.now()})),(await u).builder.reset(),window.location.href="/order-completed"},window.fastSpringPopupClosed=()=>{const t=w();t.parentElement===document.body&&document.body.removeChild(t)};let a=!1;p(()=>{if(a)return;const t=document.querySelector("[data-product-view]");if(t){const n=t.getAttribute("data-product-view"),e=o().find(i=>i.pid===n);e&&(window.dataLayer.push({event:"view_item",view_product:[{item_id:e.pid,item_name:e.display,price:e.totalValue,quantity:1}],view_product_currency:s().currency,view_product_price:e.totalValue}),a=!0)}})}y(()=>{const a=setInterval(()=>{const t=window.fastspring;t&&(f(t),g(!0),clearInterval(a))},200)});export{s as a,L as b,o as c,v as d,P as e,u as f};
