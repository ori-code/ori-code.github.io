<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizer 1.0 | The Faith Sound</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/feather-icons"></script>
    
    <script src="https://www.paypal.com/sdk/js?client-id=AUjr_VTe9_mnojYbrv2wEhvIlYN3nXES7HG2hIfHpNhZchdcNGCh6WeHJtxwXkDBqS09gb2RjX-HAYEK&currency=USD"></script>

    <style>
        :root {
            --color-background: #0D0C12;
            --color-surface: #1C1B22;
            --color-primary: #FF3B5C;
            --color-primary-glow: rgba(255, 59, 92, 0.4);
            --color-text: #EAEAEA;
            --color-text-muted: #88878D;
            --font-family: 'Poppins', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            background-color: var(--color-background);
            color: var(--color-text);
            font-family: var(--font-family);
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* --- Animations --- */
        .reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.8s ease-out, transform 0.6s ease-out;
        }

        .reveal.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* --- Header --- */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 100;
            padding: 20px 0;
            background: rgba(13, 12, 18, 0.7);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-logo {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--color-text);
            text-decoration: none;
        }
        .nav-logo span {
            color: var(--color-primary);
        }

        .nav-menu {
            display: flex;
            align-items: center;
            gap: 32px;
            list-style: none;
        }

        .nav-link {
            color: var(--color-text-muted);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }
        .nav-link:hover {
            color: var(--color-text);
        }

        .donate-link {
            background: var(--color-primary);
            color: #FFF !important;
            padding: 10px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px var(--color-primary-glow);
        }
        .donate-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--color-primary-glow);
        }

        .nav-buttons {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .nav-cta {
            background: var(--color-primary);
            color: #FFF;
            padding: 10px 24px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px var(--color-primary-glow);
        }
        .nav-cta:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--color-primary-glow);
        }

        /* --- Hero Section --- */
        .hero {
            position: relative;
            padding: 180px 0 100px;
            text-align: center;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .hero-aurora {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 800px;
            height: 600px;
            background: radial-gradient(circle, var(--color-primary-glow) 0%, transparent 60%);
            z-index: 0;
            animation: pulse 8s infinite ease-in-out;
        }

        @keyframes pulse {
            0% { transform: translateX(-50%) scale(1); opacity: 0.7; }
            50% { transform: translateX(-50%) scale(1.2); opacity: 1; }
            100% { transform: translateX(-50%) scale(1); opacity: 0.7; }
        }
        
        .hero-content {
            position: relative;
            z-index: 1;
        }

        .hero h1 {
            font-size: 4.5rem;
            font-weight: 700;
            letter-spacing: -2px;
            line-height: 1.1;
            background: linear-gradient(120deg, var(--color-primary), #FFF);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 24px;
        }

        .hero p {
            font-size: 1.25rem;
            color: var(--color-text-muted);
            max-width: 650px;
            margin: 0 auto 40px;
            line-height: 1.6;
        }

        .hero-image-container {
            margin-top: 60px;
            position: relative;
            z-index: 2;
        }

        .hero-image {
            width: 100%;
            max-width: 800px;
            border-radius: 12px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* --- Section --- */
        .section {
            padding: 100px 0;
        }

        .section-title {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .section-subtitle {
            text-align: center;
            font-size: 1.1rem;
            color: var(--color-text-muted);
            margin-bottom: 60px;
        }

        /* --- Features Section --- */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .feature-card {
            background: rgba(28, 27, 34, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(5px);
            padding: 32px;
            border-radius: 16px;
            transition: all 0.3s ease;
        }
        .feature-card:hover {
            transform: translateY(-5px);
            border-color: rgba(255, 59, 92, 0.5);
        }

        .feature-icon {
            width: 48px;
            height: 48px;
            color: var(--color-primary);
            margin-bottom: 24px;
        }
        
        .feature-card h3 {
            font-size: 1.5rem;
            margin-bottom: 12px;
            color: var(--color-text);
        }

        .feature-card p {
            color: var(--color-text-muted);
            line-height: 1.7;
        }
        
        /* --- Demo Section --- */
        .demo-video-wrapper {
            position: relative;
            padding-top: 56.25%;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .demo-video-wrapper iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
        }

        /* --- Podcast Section --- */
        .podcast-video-wrapper {
            position: relative;
            padding-top: 56.25%;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
            border: 1px solid rgba(255,255,255,0.1);
            background: var(--color-surface);
        }

        .podcast-video-wrapper iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
        }

        .podcast-description {
            margin-top: 40px;
            text-align: center;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .podcast-description p {
            color: var(--color-text-muted);
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 20px;
        }

        .podcast-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 59, 92, 0.1);
            border: 1px solid var(--color-primary);
            padding: 10px 20px;
            border-radius: 25px;
            color: var(--color-primary);
            font-weight: 600;
            margin-top: 20px;
        }

        .podcast-badge i {
            width: 20px;
            height: 20px;
        }

        /* --- Pricing Section --- */
        .pricing-card {
            background: linear-gradient(145deg, var(--color-surface), var(--color-background));
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            max-width: 450px;
            margin: 0 auto;
            padding: 40px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .pricing-card h3 {
            font-size: 1.75rem;
            font-weight: 600;
        }
        
        .pricing-price {
            font-size: 4rem;
            font-weight: 700;
            color: var(--color-primary);
            margin: 20px 0;
        }
        .pricing-price span {
            font-size: 1rem;
            font-weight: 400;
            color: var(--color-text-muted);
        }
        
        .pricing-features {
            list-style: none;
            margin: 30px 0;
            text-align: left;
            display: inline-block;
        }

        .pricing-features li {
            margin-bottom: 12px;
            color: var(--color-text-muted);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .pricing-features .icon {
            color: var(--color-primary);
            width: 20px;
            height: 20px;
        }

        .pricing-cta {
            display: block;
            width: 100%;
            padding: 16px;
            margin-top: 20px;
        }

        /* --- ChordsApp Promo Section --- */
        .chordsapp-section {
            position: relative;
            background: radial-gradient(circle at top right, rgba(255, 59, 92, 0.18), transparent 45%), var(--color-background);
            border-top: 1px solid rgba(255, 255, 255, 0.04);
            border-bottom: 1px solid rgba(255, 255, 255, 0.04);
        }

        .chordsapp-grid {
            display: grid;
            gap: 40px;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            align-items: center;
        }

        .chordsapp-copy {
            background: rgba(28, 27, 34, 0.65);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 48px 40px;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.35);
        }

        .chordsapp-copy .section-title,
        .chordsapp-copy .section-subtitle {
            text-align: left;
        }

        .chordsapp-copy .section-subtitle {
            margin-bottom: 32px;
            max-width: 480px;
        }

        .chordsapp-list {
            list-style: none;
            margin: 0 0 36px;
            padding: 0;
            display: grid;
            gap: 16px;
        }

        .chordsapp-list li {
            display: flex;
            align-items: center;
            gap: 14px;
            color: var(--color-text-muted);
        }

        .chordsapp-list i {
            width: 22px;
            height: 22px;
            color: var(--color-primary);
        }

        .chordsapp-actions {
            display: flex;
            gap: 18px;
            flex-wrap: wrap;
        }

        .chordsapp-secondary {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            color: var(--color-text-muted);
            font-weight: 500;
            transition: color 0.2s ease;
        }

        .chordsapp-secondary:hover,
        .chordsapp-secondary:focus {
            color: var(--color-text);
        }

        .chordsapp-secondary i {
            width: 18px;
            height: 18px;
        }

        .chordsapp-preview {
            background: rgba(10, 10, 16, 0.92);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 30px 70px rgba(0, 0, 0, 0.4);
        }

        .chordsapp-card {
            background: rgba(255, 255, 255, 0.04);
            border-radius: 18px;
            padding: 28px;
            border: 1px solid rgba(255, 255, 255, 0.06);
        }

        .chordsapp-card header {
            display: flex;
            justify-content: space-between;
            font-weight: 600;
            margin-bottom: 18px;
        }

        .chordsapp-card header span:last-child {
            color: var(--color-primary);
        }

        .chordsapp-card-lines {
            display: grid;
            gap: 16px;
        }

        .chordsapp-card-line {
            display: flex;
            justify-content: space-between;
            font-size: 0.95rem;
        }

        .chordsapp-card-line span:first-child {
            font-weight: 600;
            color: var(--color-primary);
            min-width: 60px;
        }

        .chordsapp-card-line span:last-child {
            color: rgba(234, 234, 234, 0.9);
            padding-left: 14px;
        }

        /* --- Footer --- */
        .footer {
            padding: 50px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            text-align: center;
        }
        .footer p {
            color: var(--color-text-muted);
            font-size: 0.9rem;
        }
        
        /* --- Responsive --- */
        @media (max-width: 768px) {
            .nav-menu {
                display: none;
            }
            
            .nav-cta {
                padding: 8px 16px;
                font-size: 0.9rem;
            }
            
            .hero {
                padding: 140px 0 60px;
            }
            
            .hero h1 {
                font-size: 2.5rem;
                letter-spacing: -1px;
            }
            
            .hero p {
                font-size: 1rem;
                padding: 0 10px;
            }
            
            .hero-image-container {
                margin-top: 40px;
            }
            
            .section {
                padding: 60px 0;
            }
            
            .section-title {
                font-size: 2rem;
            }
            
            .section-subtitle {
                font-size: 1rem;
                padding: 0 10px;
            }
            
            .features-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .feature-card {
                padding: 24px;
            }
            
            .pricing-card {
                padding: 30px 20px;
            }
            
            .pricing-price {
                font-size: 2.5rem;
            }
            
            .chordsapp-grid {
                grid-template-columns: 1fr;
            }

            .chordsapp-copy {
                padding: 32px 24px;
            }

            .chordsapp-preview {
                padding: 28px 24px;
            }
            
            .pricing-price span:first-child {
                font-size: 1.8rem !important;
            }
            
            .pricing-price span:last-child {
                font-size: 0.9rem !important;
                padding: 2px 10px !important;
                display: block;
                margin: 10px auto 0 !important;
                max-width: 150px;
            }
            
            .podcast-description p {
                font-size: 1rem;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 0 16px;
            }
            
            .header {
                padding: 15px 0;
            }
            
            .nav-logo {
                font-size: 1.2rem;
            }
            
            .hero h1 {
                font-size: 2rem;
            }
            
            .section-title {
                font-size: 1.75rem;
            }
            
            .feature-card h3 {
                font-size: 1.3rem;
            }
            
            .pricing-card h3 {
                font-size: 1.5rem;
            }
            
            .pricing-price {
                font-size: 2rem;
            }

            .chordsapp-actions {
                flex-direction: column;
            }

            .chordsapp-card-line {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }
        }

    </style>
</head>

<body>

<!-- Enhanced Chat Widget -->
<button id="chat-toggle">💬</button>
<div id="chat-widget">
    <div id="chat-header">
        <span>💬 Chat with Us</span>
        <button id="chat-close">×</button>
    </div>
    <div id="chat-body"></div>
    <div id="chat-input-container">
        <input type="text" id="chat-input" placeholder="Type your message..." />
        <button id="chat-send">Send</button>
    </div>
</div>

<style>
/* Enhanced Chat Widget Styles */
#chat-toggle {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 60px;
    height: 60px;
    background: var(--color-primary);
    border: none;
    border-radius: 50%;
    color: white;
    font-size: 1.5rem;
    cursor: pointer;
    box-shadow: 0 4px 20px var(--color-primary-glow);
    z-index: 1001;
    transition: all 0.3s ease;
}

#chat-toggle:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 25px var(--color-primary-glow);
}

#chat-widget {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 350px;
    max-width: calc(100vw - 40px);
    max-height: calc(100vh - 40px);
    background: #1C1B22;
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 12px;
    overflow: hidden;
    font-family: 'Poppins', sans-serif;
    box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    z-index: 1000;
    transform: translateY(100%);
    opacity: 0;
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
}

#chat-widget.open {
    transform: translateY(0);
    opacity: 1;
}

#chat-header {
    background: var(--color-primary);
    color: white;
    padding: 15px;
    font-weight: bold;
    text-align: center;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-shrink: 0;
}

#chat-close {
    background: none;
    border: none;
    color: white;
    font-size: 1.5rem;
    cursor: pointer;
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: background 0.3s ease;
}

#chat-close:hover {
    background: rgba(255,255,255,0.2);
}

#chat-body {
    height: 300px;
    overflow-y: auto;
    padding: 15px;
    color: #EAEAEA;
    background: var(--color-surface);
    flex: 1;
    -webkit-overflow-scrolling: touch;
}

#chat-body::-webkit-scrollbar {
    width: 6px;
}

#chat-body::-webkit-scrollbar-track {
    background: rgba(255,255,255,0.1);
}

#chat-body::-webkit-scrollbar-thumb {
    background: var(--color-primary);
    border-radius: 3px;
}

.chat-msg {
    margin-bottom: 15px;
    padding: 12px 16px;
    border-radius: 18px;
    max-width: 85%;
    word-wrap: break-word;
    word-break: break-word;
    line-height: 1.4;
    animation: messageSlide 0.3s ease;
}

@keyframes messageSlide {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.chat-msg.user {
    background: var(--color-primary);
    color: white;
    margin-left: auto;
    text-align: right;
    border-bottom-right-radius: 4px;
}

.chat-msg.bot {
    background: rgba(255,255,255,0.1);
    color: var(--color-text);
    border-bottom-left-radius: 4px;
}

.chat-msg.typing {
    background: rgba(255,255,255,0.05);
    color: var(--color-text-muted);
    font-style: italic;
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 0.6; }
    50% { opacity: 1; }
}

#chat-input-container {
    display: flex;
    border-top: 1px solid rgba(255,255,255,0.1);
    background: var(--color-surface);
    flex-shrink: 0;
}

#chat-input {
    flex: 1;
    padding: 15px;
    border: none;
    outline: none;
    background: transparent;
    color: white;
    font-family: inherit;
    font-size: 14px;
}

#chat-input::placeholder {
    color: var(--color-text-muted);
}

#chat-input:disabled {
    opacity: 0.6;
}

#chat-send {
    background: var(--color-primary);
    color: white;
    border: none;
    padding: 15px 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 600;
    min-width: 70px;
    font-size: 14px;
}

#chat-send:hover:not(:disabled) {
    background: #e6345a;
}

#chat-send:active:not(:disabled) {
    transform: scale(0.95);
}

#chat-send:disabled {
    background: #666;
    cursor: not-allowed;
    transform: none;
}

/* Mobile Responsive - Enhanced */
@media (max-width: 768px) {
    #chat-widget {
        width: calc(100vw - 20px);
        right: 10px;
        left: 10px;
        bottom: 10px;
        max-height: calc(100vh - 100px);
    }
    
    #chat-toggle {
        right: 15px;
        bottom: 15px;
        width: 56px;
        height: 56px;
        font-size: 1.4rem;
    }
    
    #chat-body {
        height: auto;
        max-height: calc(100vh - 250px);
        min-height: 200px;
    }
    
    #chat-header {
        padding: 14px 12px;
        font-size: 15px;
    }
    
    #chat-input {
        padding: 14px 12px;
        font-size: 16px;
    }
    
    #chat-send {
        padding: 14px 18px;
        min-width: 65px;
    }
    
    .chat-msg {
        padding: 11px 14px;
        font-size: 14px;
        max-width: 90%;
    }
}

@media (max-width: 480px) {
    #chat-widget {
        width: calc(100vw - 16px);
        right: 8px;
        left: 8px;
        bottom: 8px;
        border-radius: 10px;
        max-height: calc(100vh - 80px);
    }
    
    #chat-toggle {
        right: 12px;
        bottom: 12px;
        width: 52px;
        height: 52px;
        font-size: 1.3rem;
    }
    
    #chat-header {
        padding: 12px 10px;
        font-size: 14px;
    }
    
    #chat-close {
        width: 28px;
        height: 28px;
        font-size: 1.3rem;
    }
    
    #chat-body {
        padding: 12px;
        max-height: calc(100vh - 220px);
        min-height: 180px;
    }
    
    #chat-input {
        padding: 13px 12px;
        font-size: 16px;
    }
    
    #chat-send {
        padding: 13px 16px;
        font-size: 13px;
        min-width: 60px;
    }
    
    .chat-msg {
        padding: 10px 13px;
        font-size: 14px;
        margin-bottom: 12px;
        border-radius: 16px;
    }
}

@media (max-width: 360px) {
    #chat-toggle {
        width: 48px;
        height: 48px;
        font-size: 1.2rem;
        right: 10px;
        bottom: 10px;
    }
    
    #chat-widget {
        width: calc(100vw - 12px);
        right: 6px;
        left: 6px;
        bottom: 6px;
    }
    
    #chat-header {
        padding: 10px 8px;
        font-size: 13px;
    }
    
    #chat-body {
        padding: 10px;
        max-height: calc(100vh - 200px);
        min-height: 160px;
    }
    
    #chat-input {
        padding: 12px 10px;
        font-size: 16px;
    }
    
    #chat-send {
        padding: 12px 14px;
        font-size: 12px;
        min-width: 55px;
    }
    
    .chat-msg {
        font-size: 13px;
        padding: 9px 12px;
    }
}

/* Landscape mode adjustments for mobile */
@media (max-height: 500px) and (max-width: 768px) {
    #chat-widget {
        max-height: calc(100vh - 60px);
        bottom: 5px;
    }
    
    #chat-body {
        max-height: calc(100vh - 180px);
        min-height: 150px;
    }
    
    #chat-toggle {
        bottom: 10px;
        right: 10px;
    }
}
</style>

<script>
// Chat Widget with Memory Functionality
document.addEventListener('DOMContentLoaded', function() {
  const chatToggle = document.getElementById('chat-toggle');
  const chatWidget = document.getElementById('chat-widget');
  const chatClose  = document.getElementById('chat-close');
  const chatBody   = document.getElementById('chat-body');
  const chatInput  = document.getElementById('chat-input');
  const chatSend   = document.getElementById('chat-send');

  let SESSION_ID = localStorage.getItem('chatSessionId');
  if (!SESSION_ID) {
    SESSION_ID = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    localStorage.setItem('chatSessionId', SESSION_ID);
    console.log('New chat session created:', SESSION_ID);
  } else {
    console.log('Existing chat session loaded:', SESSION_ID);
  }

  const LOCAL_WEBHOOK = "http://localhost:5678/webhook/ai-chat";
  const PERMANENT_WEBHOOK = "https://chat.thefaithsound.com/webhook/ai-chat";
  const PROD_WEBHOOK = "https://chat.thefaithsound.com/webhook/ai-chat";

  const qsWebhook = new URLSearchParams(location.search).get('webhook');
  const isLocal = (location.hostname === "localhost" || 
                   location.hostname === "127.0.0.1" || 
                   location.protocol === "file:");
  
  const byHost = isLocal ? LOCAL_WEBHOOK : PROD_WEBHOOK;
  let N8N_WEBHOOK_URL = qsWebhook || byHost;

  function appendMessage(text, sender) {
    const msg = document.createElement('div');
    msg.className = 'chat-msg ' + sender;
    msg.textContent = text;
    chatBody.appendChild(msg);
    chatBody.scrollTop = chatBody.scrollHeight;
  }
  
  function showTyping() {
    const typing = document.createElement('div');
    typing.className = 'chat-msg typing';
    typing.id = 'typing-indicator';
    typing.textContent = 'AI is typing...';
    chatBody.appendChild(typing);
    chatBody.scrollTop = chatBody.scrollHeight;
  }
  
  function hideTyping() {
    const t = document.getElementById('typing-indicator');
    if (t) t.remove();
  }
  
  function setProcessing(on) {
    chatSend.disabled = on;
    chatInput.disabled = on;
    chatSend.textContent = on ? '...' : 'Send';
  }

  function loadChatHistory() {
    const chatHistory = localStorage.getItem('chatHistory_' + SESSION_ID);
    if (chatHistory) {
      try {
        const messages = JSON.parse(chatHistory);
        messages.forEach(msg => {
          appendMessage(msg.text, msg.sender);
        });
        console.log('Chat history loaded:', messages.length, 'messages');
      } catch (e) {
        console.warn('Failed to load chat history:', e);
      }
    }
  }

  function saveMessageToHistory(text, sender) {
    try {
      const historyKey = 'chatHistory_' + SESSION_ID;
      let history = [];
      const existingHistory = localStorage.getItem(historyKey);
      if (existingHistory) {
        history = JSON.parse(existingHistory);
      }
      
      history.push({ text, sender, timestamp: new Date().toISOString() });
      
      if (history.length > 50) {
        history = history.slice(-50);
      }
      
      localStorage.setItem(historyKey, JSON.stringify(history));
    } catch (e) {
      console.warn('Failed to save message to history:', e);
    }
  }

  async function sendToWebhook(payload) {
    const candidates = [N8N_WEBHOOK_URL,
      N8N_WEBHOOK_URL === LOCAL_WEBHOOK ? PROD_WEBHOOK : LOCAL_WEBHOOK
    ].filter(Boolean);

    let lastError;
    for (const url of candidates) {
      try {
        const controller = new AbortController();
        const timeout = setTimeout(() => controller.abort(), 20000);
        
        const fetchOptions = {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json, text/plain, */*'
          },
          body: JSON.stringify(payload),
          signal: controller.signal
        };

        if (location.protocol !== "file:") {
          fetchOptions.mode = "cors";
        }

        const r = await fetch(url, fetchOptions);
        clearTimeout(timeout);
        
        if (!r.ok) throw new Error(`HTTP ${r.status}`);
        
        N8N_WEBHOOK_URL = url;
        const ct = r.headers.get('content-type') || '';
        return ct.includes('application/json') ? r.json() : r.text();
      } catch (e) {
        lastError = e;
        console.warn(`Failed to connect to ${url}:`, e.message);
      }
    }
    throw lastError || new Error('Request failed');
  }

  function appendMessageWithHistory(text, sender) {
    appendMessage(text, sender);
    saveMessageToHistory(text, sender);
  }

  chatToggle.addEventListener('click', () => {
    chatWidget.classList.add('open');
    chatToggle.style.display = 'none';
    
    if (chatBody.children.length === 0) {
      loadChatHistory();
      
      if (chatBody.children.length === 0) {
        setTimeout(() => {
          appendMessageWithHistory("Hello! I'm here to help with Visualizer 1.0. I remember our previous conversations!", 'bot');
        }, 300);
      }
    }
    setTimeout(() => chatInput.focus(), 100);
  });
  
  chatClose.addEventListener('click', () => {
    chatWidget.classList.remove('open');
    chatToggle.style.display = 'block';
  });

  async function sendMessage() {
    const message = chatInput.value.trim();
    if (!message || chatSend.disabled) return;

    setProcessing(true);
    appendMessageWithHistory(message, 'user');
    chatInput.value = '';
    showTyping();

    const payload = {
      message,
      chatInput: message,
      sessionId: SESSION_ID,
      userId: SESSION_ID,
      chatId: SESSION_ID,
      body: { 
        message, 
        chatInput: message, 
        sessionId: SESSION_ID,
        timestamp: new Date().toISOString() 
      },
      timestamp: new Date().toISOString(),
      user: "website-visitor",
      origin: location.origin || "file://"
    };

    try {
      const data = await sendToWebhook(payload);
      hideTyping();
      let reply = '';
      if (data && typeof data === 'object') {
        reply = data.response || data.answer || data.output || data.result || JSON.stringify(data, null, 2);
      } else {
        reply = String(data ?? '');
      }
      const finalReply = reply || "Message received.";
      appendMessageWithHistory(finalReply, 'bot');
    } catch (err) {
      hideTyping();
      console.error('Chat error:', err);
      
      let errorMessage = "I'm having trouble connecting right now. Please try again shortly.";
      appendMessageWithHistory(errorMessage, 'bot');
      
      console.log('Debug Info:');
      console.log('- Session ID:', SESSION_ID);
      console.log('- Webhook URL:', N8N_WEBHOOK_URL);
      console.log('- Error:', err.message);
    } finally {
      setProcessing(false);
      chatInput.focus();
    }
  }

  chatSend.addEventListener('click', sendMessage);
  chatInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });

  console.log('Chat initialized with memory functionality');
  console.log('Session ID:', SESSION_ID);
  console.log('Webhook URL:', N8N_WEBHOOK_URL);
});
</script>

    <header class="header">
        <nav class="nav container">
            <a href="#" class="nav-logo">THE FAITH <span>SOUND</span></a>
            <ul class="nav-menu">
                <li><a href="#features" class="nav-link">Features</a></li>
                <li><a href="#demo" class="nav-link">Demo</a></li>
                <li><a href="#podcast" class="nav-link">Podcast</a></li>
                <li><a href="#pricing" class="nav-link">Pricing</a></li>
            </ul>
            <div class="nav-buttons">
                <a href="ChordsApp/index.html" class="nav-cta">ChordsApp</a>
                <a href="#pricing" class="nav-cta">Buy Now</a>
            </div>
        </nav>
    </header>

    <main>
        <section id="home" class="hero">
            <div class="hero-aurora"></div>
            <div class="hero-content container">
                <h1 class="reveal">Visualize Your Sound.</h1>
                <p class="reveal" style="transition-delay: 0.1s;">Visualizer 1.0 is a revolutionary FX plugin that provides seamless, real-time visual feedback for your MIDI controller, inspired by the legendary Korg NanoKontrol2.</p>
                <div class="reveal" style="transition-delay: 0.2s;">
                    <a href="#pricing" class="nav-cta">Get Your Copy Now of Visualizer 1.0</a>
                </div>
            </div>
            <div class="hero-image-container container reveal" style="transition-delay: 0.3s;">
                <img src="https://res.cloudinary.com/dmylbfztz/image/upload/v1748356162/Photo_With_Plugin_Small_Size_w5kmri.jpg" alt="Visualizer 1.0 Plugin Interface" class="hero-image">
            </div>
        </section>

        <section id="features" class="section">
            <div class="container">
                <h2 class="section-title reveal">Unparalleled Control & Clarity</h2>
                <p class="section-subtitle reveal">Everything you need for an intuitive and efficient production workflow.</p>
                <div class="features-grid">
                    <div class="feature-card reveal">
                        <i data-feather="edit" class="feature-icon"></i>
                        <h3>Editable Labels</h3>
                        <p>Rename all 8 sliders and knobs to perfectly match your DAW's parameters. Eliminate guesswork and stay in your creative flow.</p>
                    </div>
                    <div class="feature-card reveal" style="transition-delay: 0.1s;">
                        <i data-feather="bar-chart-2" class="feature-icon"></i>
                        <h3>Responsive Graphics</h3>
                        <p>Get instant, buttery-smooth visual feedback for every tweak. See your sound change in real time with our dynamic interface.</p>
                    </div>
                    <div class="feature-card reveal" style="transition-delay: 0.2s;">
                        <i data-feather="toggle-right" class="feature-icon"></i>
                        <h3>Configurable Buttons</h3>
                        <p>Map complex functions and trigger actions with fully customizable buttons. Your workflow, your rules.</p>
                    </div>
                </div>
            </div>
        </section>



        <section id="podcast" class="section">
            <div class="container">
                <h2 class="section-title reveal">Deep Dive Podcast</h2>
                <p class="section-subtitle reveal">Listen to our in-depth discussion about Visualizer 1.0, its features, and how it can revolutionize your music production workflow.</p>
                
                <div class="podcast-video-wrapper reveal">
                    <iframe 
                        src="https://www.youtube.com/embed/wpzQJxGNdD4" 
                        title="Visualizer 1.0 Podcast - Deep Dive Discussion" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen>
                    </iframe>
                </div>
                
                <!-- <div class="podcast-description reveal">
                    <p>Join us for an inspiring conversation about the vision and innovation behind Visualizer 1.0, the groundbreaking VST plugin by The Faith Sound Company.
                            Discover how real-stage challenges sparked the idea for a tool that brings clarity, creativity, and real-time control to producers and performers everywhere.

                            In this episode, you’ll hear how Visualizer 1.0:

                            Transforms any MIDI controller with custom labels and live feedback

                            Keeps you focused on music, not guesswork

                            Empowers producers, engineers, and stage artists to perform with confidence

                            Tune in and experience the story of how one simple idea became a must-have plugin for the modern music creator.

                            🎙️ Listen now to the full episode →</p>
                    
                 <div class="podcast-badge">
                        <i data-feather="mic"></i>
                        <span>Listen to our Podcast Episode</span>
                </div> 
                </div> -->
            </div>
        </section>


     


        <section id="demo" class="section">
            <div class="container">
                <h2 class="section-title reveal">See It In Action</h2>
                <p class="section-subtitle reveal">Watch how Visualizer 1.0 can transform your music production experience.</p>
                <div class="demo-video-wrapper reveal">
                    <iframe src="https://www.youtube.com/embed/9_nSaM-X2J0?si=2ayp3910K0EPGPoh" title="Visualizer 1.0 Demo Video" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                </div>
            </div>
        </section>

        <section id="pricing" class="section">
            <div class="container">
                <h2 class="section-title reveal">Get Visualizer 1.0 Today</h2>
                <p class="section-subtitle reveal">A single purchase for a lifetime of creative clarity.</p>
                <div class="pricing-card reveal">
                    <h3>Our first VST Plugin</h3>
                    <div class="pricing-price">
                        <span style="text-decoration: line-through; color: var(--color-text-muted); font-size: 2.5rem; margin-right: 10px;">
                            $39.99
                        </span>
                        <span style="color: var(--color-primary); font-size: 3.0rem; font-weight: bold;">$29.99</span>
                        <span style="background: var(--color-primary); color: #fff; font-size: 2.0rem; padding: 3px 62px; border-radius: 6px; margin-left: 8px;">
                            Limited Offer
                        </span>
                    </div>

                    <ul class="pricing-features">
                        <li><i data-feather="check-circle" class="icon"></i><span>Lifetime Updates Included</span></li>
                        <li><i data-feather="check-circle" class="icon"></i><span>Works with all Major DAWs</span></li>
                        <li><i data-feather="check-circle" class="icon"></i><span>30-Day Money-Back Guarantee</span></li>
                        <li><i data-feather="check-circle" class="icon"></i><span>Secure Instant Purchase</span></li>
                    </ul>
                    
                    <div id="paypal-button-container" style="margin-top: 30px;"></div>

                </div>
            </div>
        </section>

       
    </main>

    <footer class="footer">
        <div class="container">
            <p>© 2025 The Faith Sound. All Rights Reserved.</p>
        </div>
    </footer>

    <script>
        // Initialize Feather Icons
        feather.replace();

        // Reveal on scroll animation
        const revealObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, {
            threshold: 0.1
        });

        document.querySelectorAll('.reveal').forEach(el => {
            revealObserver.observe(el);
        });

        // PayPal Integration
        paypal.Buttons({
            createOrder: function(data, actions) {
                return actions.order.create({
                    purchase_units: [{
                        description: 'Visualizer 1.0 VST Plugin - Lifetime License',
                        amount: {
                            value: '29.99'
                        }
                    }]
                });
            },
            onApprove: function(data, actions) {
                return actions.order.capture().then(orderDetails => {
                    const email = orderDetails.payer.email_address;

                    const container = document.getElementById('paypal-button-container');
                    container.innerHTML = '<h3>Processing your order…</h3>';

                    fetch('https://api.thefaithsound.com/add_user', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contact_email: email })
                    })
                    .then(r => r.json())
                    .then(result => {
                        if (result.pluginKey) {
                            container.innerHTML = `
                                <h3>Thank you!</h3>
                                <p>Your license key: 
                                    <strong id="licenseKey">${result.pluginKey}</strong>
                                    <button onclick="navigator.clipboard.writeText('${result.pluginKey}')">Copy</button>
                                </p>
                                <p>We've sent a confirmation email to ${email}.</p>
                            `;
                        } else {
                            container.innerHTML = `
                                <h3>Oops!</h3>
                                <p>${result.error || 'Could not create your license. Please contact us.'}</p>
                            `;
                        }
                    })
                    .catch(err => {
                        console.error(err);
                        container.innerHTML = '<h3>An error occurred. Please contact support.</h3>';
                    });
                });
            },
            onError: function(err) {
                console.error('PayPal error:', err);
                alert('Payment error — please try again.');
            }
        }).render('#paypal-button-container');
    </script>
</body>
</html>
