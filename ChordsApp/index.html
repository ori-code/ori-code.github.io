<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChordsApp | The Faith Sound</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://www.paypal.com/sdk/js?client-id=AUjr_VTe9_mnojYbrv2wEhvIlYN3nXES7HG2hIfHpNhZchdcNGCh6WeHJtxwXkDBqS09gb2RjX-HAYEK&currency=USD"></script>
</head>
<body>
    <header class="app-header">
        <div class="brand">
            <span class="brand-mark">♪</span>
            <div>
                <span class="brand-title">ChordsApp</span>
                <span class="brand-subtitle">beta workspace</span>
            </div>
        </div>
        <nav class="app-nav">
            <a href="../index.html" class="nav-link">Back to main site</a>
            <a href="#workflow" class="nav-link">Workflow</a>
            <a href="#editor" class="nav-link">Editor</a>
            <a href="#next" class="nav-link">Next steps</a>
        </nav>
    </header>

    <main class="container">
        <section class="hero" id="top">
            <div class="hero-text">
                <h1>Turn any chord sheet into a clean, printable chart.</h1>
                <p>Upload a handwritten sheet or photo, let AI extract the music, refine the result, transpose to any key, then print with confidence.</p>
                <div class="hero-actions">
                    <label class="primary-action" for="chartFileInput">Start with an upload</label>
                    <a class="secondary-action" href="#workflow">See the workflow</a>
                </div>
            </div>
        </section>

        <section class="workflow" id="workflow">
            <h2>Three simple steps</h2>
            <div class="workflow-grid">
                <article class="step-card">
                    <span class="step-number">1</span>
                    <h3>Upload your chart</h3>
                    <p>Accepts images (JPG, PNG, HEIC) and PDFs. High contrast photos deliver the best recognition results.</p>
                    <label class="upload-tile" for="chartFileInput">
                        <span class="upload-icon">⬆︎</span>
                        <span class="upload-label">Choose a file</span>
                        <span class="upload-note">Drag &amp; drop coming soon</span>
                    </label>
                    <input id="chartFileInput" class="sr-only" type="file" accept="image/*,.pdf">
                    <div class="preview-panel" id="uploadPreview">
                        <img id="previewImage" alt="Uploaded chart preview">
                        <p class="preview-placeholder">No file selected yet. Supported: JPG, PNG, HEIC, PDF.</p>
                    </div>
                </article>
                <article class="step-card">
                    <span class="step-number">2</span>
                    <h3>Run transcription</h3>
                    <!-- <p>Connect the Vision + Music model of your choice. Right now this demo simulates the response so you can design the experience.</p> -->
                    <button id="analyzeButton" class="primary-action" disabled>Analyze</button>
                    <div class="status-panel" id="analysisStatus" role="status" aria-live="polite">
                        <span class="status-dot idle"></span>
                        <span class="status-text">Waiting for an upload…</span>
                    </div>
                    <small class="status-hint">Analysis typically takes 3-5 seconds. Supports English and Hebrew text.</small>
                </article>
                <article class="step-card">
                    <span class="step-number">3</span>
                    <h3>Refine, transpose &amp; print</h3>
                    <p>Edit chords visually on the left panel. The SongBook format (middle) updates automatically. AI original stays on the right for reference.</p>
                    <ul class="feature-list">
                        <li>Visual editing - move chords with spaces</li>
                        <li>Transpose to any key</li>
                        <li>Auto-converts to SongBook format</li>
                        <li>Print or export as PDF</li>
                    </ul>
                    <div class="ai-reference-preview" id="aiReferencePreview">
                        <h4>AI Original (reference)</h4>
                        <p class="reference-subtitle">Original AI extraction</p>
                        <div class="reference-content" id="aiReferenceContent">
                            <p class="preview-placeholder">AI transcription will appear here after analysis.</p>
                        </div>
                    </div>
                </article>
            </div>
        </section>

        <section class="editor" id="editor">
            <div class="editor-header">
                <h2>Chord workspace</h2>
                <div class="transpose-controls">
                    <span>Transpose:</span>
                    <button class="ghost-button" data-shift="-1">–1</button>
                    <button class="ghost-button" data-shift="1">+1</button>
                    <label class="transpose-label">
                        Steps
                        <input type="number" id="transposeStepInput" value="0" min="-11" max="11">
                    </label>
                    <button class="ghost-button" id="applyTranspose">Apply</button>
                    <button class="ghost-button" id="resetTranspose">Reset</button>
                </div>
                <div class="editor-actions">
                    <button class="ghost-button" id="copyToClipboard">Copy text</button>
                    <button class="primary-action" id="printButton">Print chart</button>
                </div>
            </div>
            <div class="editor-columns">
                <div class="editor-panel">
                    <header>
                        <h3>Visual Editor (edit here)</h3>
                        <small>Chords above lyrics - adjust spacing freely</small>
                    </header>
                    <textarea id="visualEditor" placeholder="Edit chords and lyrics with visual spacing..."></textarea>
                </div>
                <div class="editor-panel">
                    <header>
                        <h3>SongBook Format (auto-updated)</h3>
                        <small>Copy this to SongBook app</small>
                    </header>
                    <textarea id="songbookOutput" readonly placeholder="SongBook format with [C] brackets will appear here..."></textarea>
                </div>
            </div>
        </section>

        <section class="preview-section" id="previewSection">
            <div class="preview-header">
                <h2>Print Preview</h2>
                <div class="preview-controls">
                    <label class="font-size-control">
                        Font Size: <span id="fontSizeValue">10</span>pt
                        <input type="range" id="fontSizeSlider" min="8" max="14" value="10" step="0.5">
                    </label>
                    <label class="line-height-control">
                        Line Spacing: <span id="lineHeightValue">1.3</span>
                        <input type="range" id="lineHeightSlider" min="1.0" max="2.0" value="1.3" step="0.1">
                    </label>
                </div>
            </div>
            <div class="preview-container">
                <div id="livePreview" class="live-preview"></div>
            </div>
        </section>

        <section class="support-section" style="max-width: 600px; margin: 60px auto 80px; padding: 30px 20px; text-align: center;">
            <h2 style="font-size: 2rem; margin-bottom: 20px;">Support ChordsApp</h2>
            <p style="font-size: 1rem; color: var(--text-muted, #999); margin-bottom: 30px;">
                This app is free to use. If you find it helpful, consider supporting its development.
            </p>
            <div style="max-width: 400px; margin: 0 auto;">
                <div class="donation-amount-container">
                    <label for="donationAmount" class="donation-label">Donation Amount (USD)</label>
                    <input type="number" id="donationAmount" class="donation-input" placeholder="10" min="1" step="0.01" value="10">
                </div>
                <div id="paypal-button-container"></div>
            </div>
        </section>
    </main>

    <footer class="app-footer">
        <p>&copy; <span id="year"></span> The Faith Sound. Built with love for worship leaders and musicians.</p>
    </footer>

    <!-- Hidden print-only formatted version -->
    <div id="printPreview" class="print-only" style="display: none;"></div>

    <!-- Custom Modal -->
    <div id="customModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 id="modalTitle">Modal Title</h3>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            <div class="modal-body">
                <p id="modalMessage">Modal message goes here.</p>
                <input type="number" id="modalInput" class="modal-input" placeholder="10" min="1" step="0.01" style="display: none;">
            </div>
            <div class="modal-footer">
                <button class="ghost-button" id="modalCancel">Cancel</button>
                <button class="primary-action" id="modalConfirm">OK</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>

    <script>
        // Custom Modal System
        const modal = {
            overlay: document.getElementById('customModal'),
            title: document.getElementById('modalTitle'),
            message: document.getElementById('modalMessage'),
            input: document.getElementById('modalInput'),
            confirmBtn: document.getElementById('modalConfirm'),
            cancelBtn: document.getElementById('modalCancel'),
            closeBtn: document.getElementById('modalClose'),

            show: function(title, message, showInput = false) {
                return new Promise((resolve, reject) => {
                    this.title.textContent = title;
                    this.message.textContent = message;
                    this.input.style.display = showInput ? 'block' : 'none';
                    if (showInput) this.input.value = '10';
                    this.overlay.style.display = 'flex';

                    const handleConfirm = () => {
                        if (showInput) {
                            const value = parseFloat(this.input.value);
                            if (!value || value <= 0) {
                                this.input.style.borderColor = 'var(--primary)';
                                setTimeout(() => {
                                    this.input.style.borderColor = '';
                                }, 500);
                                return;
                            }
                            this.close();
                            resolve(value);
                        } else {
                            this.close();
                            resolve(true);
                        }
                    };

                    const handleCancel = () => {
                        this.close();
                        resolve(null);
                    };

                    this.confirmBtn.onclick = handleConfirm;
                    this.cancelBtn.onclick = handleCancel;
                    this.closeBtn.onclick = handleCancel;
                    this.overlay.onclick = (e) => {
                        if (e.target === this.overlay) handleCancel();
                    };

                    // Enter key support
                    const handleEnter = (e) => {
                        if (e.key === 'Enter') {
                            handleConfirm();
                            document.removeEventListener('keydown', handleEnter);
                        }
                    };
                    document.addEventListener('keydown', handleEnter);
                });
            },

            close: function() {
                this.overlay.style.display = 'none';
                this.input.style.borderColor = '';
            }
        };

        // PayPal Donate Button
        const donationInput = document.getElementById('donationAmount');

        paypal.Buttons({
            createOrder: function(data, actions) {
                const amount = parseFloat(donationInput.value);

                if (!amount || amount <= 0) {
                    donationInput.style.borderColor = 'var(--primary)';
                    donationInput.focus();
                    setTimeout(() => {
                        donationInput.style.borderColor = '';
                    }, 1000);
                    return null;
                }

                return actions.order.create({
                    purchase_units: [{
                        description: 'Support ChordsApp Development',
                        amount: {
                            currency_code: 'USD',
                            value: amount.toFixed(2)
                        }
                    }]
                });
            },
            onApprove: async function(data, actions) {
                return actions.order.capture().then(async function(orderDetails) {
                    await modal.show(
                        'Thank You!',
                        'Thank you for your generous support! Your contribution helps keep ChordsApp free for everyone.'
                    );
                    console.log('Donation completed:', orderDetails);
                });
            },
            onError: async function(err) {
                console.error('PayPal error:', err);
                await modal.show(
                    'Error',
                    'There was an error processing your donation. Please try again.'
                );
            }
        }).render('#paypal-button-container');
    </script>
</body>
</html>
