<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChordsApp Claude | The Faith Sound</title>

    <link rel="icon" type="image/png" href="../images/FaithSoundLogo.png">
    <link rel="apple-touch-icon" href="../images/FaithSoundLogo.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://www.paypal.com/sdk/js?client-id=AUjr_VTe9_mnojYbrv2wEhvIlYN3nXES7HG2hIfHpNhZchdcNGCh6WeHJtxwXkDBqS09gb2RjX-HAYEK&currency=USD"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>
    <header class="app-header">
        <div class="header-container">
            <a href="../index.html" class="nav-logo">THE FAITH <span>SOUND</span></a>
            <div class="header-actions">
                <div style="position: relative;">
                    <button class="ghost-button" id="signInButton" type="button">Sign In</button>
                    <div id="profileMenu" style="display: none; position: absolute; top: 45px; right: 0; background: var(--surface); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 8px; min-width: 150px; z-index: 1000;">
                        <button id="signOutBtn" style="width: 100%; padding: 8px 12px; background: transparent; color: var(--text); border: none; text-align: left; cursor: pointer; border-radius: 4px; transition: background 0.2s;">Sign Out</button>
                    </div>
                </div>
                <a href="#support" class="nav-donate">Donate & Support Us</a>
                <button class="ghost-button" id="themeToggle" type="button" title="Toggle theme">
                    <svg id="themeIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <!-- Moon icon (for dark mode) -->
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <main class="container">
        <section class="hero" id="top">
            <div class="hero-text">
                <h1>Turn any chord sheet into a clean, printable chart.</h1>
                <p>Upload a handwritten sheet or photo, let AI extract the music, refine the result, transpose to any key, then print with confidence.</p>
                <div class="hero-actions">
                    <label class="primary-action" for="chartFileInput">Start with an upload</label>
                </div>
            </div>
        </section>

        <section class="workflow" id="workflow">
            <h2>Three simple steps</h2>
            <div class="workflow-grid">
                <article class="step-card">
                    <span class="step-number">1</span>
                    <h3>Upload your chart</h3>
                    <p>Accepts images (JPG, PNG, HEIC) and PDFs. High contrast photos deliver the best recognition results.</p>
                    <label class="upload-tile" for="chartFileInput">
                        <span class="upload-icon">â¬†ï¸Ž</span>
                        <span class="upload-label">Choose a file</span>
                        <span class="upload-note">Drag &amp; drop coming soon</span>
                    </label>
                    <input id="chartFileInput" class="sr-only" type="file" accept="image/*,.pdf">
                    <div class="preview-panel" id="uploadPreview">
                        <img id="previewImage" alt="Uploaded chart preview">
                        <p class="preview-placeholder">No file selected yet. Supported: JPG, PNG, HEIC, PDF.</p>
                    </div>
                </article>
                <article class="step-card">
                    <span class="step-number">2</span>
                    <h3>AI transcription ready!</h3>
                    <p>Edit visually in the bottom Editor.</p>
                    <button id="analyzeButton" class="primary-action" disabled>Analyze</button>
                    <div class="status-panel" id="analysisStatus" role="status" aria-live="polite">
                        <span class="status-dot idle"></span>
                        <span class="status-text">Waiting for an uploadâ€¦</span>
                    </div>
                    <small class="status-hint">Analysis typically takes 15-60 seconds. Supports all languages texts. If the result is not good, try to run analyze again. AI processing costs us money - please consider <a href="#support" style="color: var(--primary); text-decoration: underline;">donating</a> to keep this free tool running.</small>
                </article>
                <article class="step-card">
                    <span class="step-number">3</span>
                    <h3>Refine, transpose &amp; print</h3>
                    <p>Edit chords visually in the editor. The SongBook format (under the editor) updates automatically. AI original stays on the right for reference.</p>
                    <ul class="feature-list">
                        <li>Visual editing - move chords with spaces</li>
                        <li>Transpose to any key</li>
                        <li>Auto-converts to SongBook format</li>
                        <li>Print or export as PDF</li>
                    </ul>
                    <div class="ai-reference-preview" id="aiReferencePreview">
                        <h4>AI Original (reference)</h4>
                        <p class="reference-subtitle">Original AI extraction</p>
                        <div class="reference-content" id="aiReferenceContent">
                            <p class="preview-placeholder">AI transcription will appear here after analysis.</p>
                        </div>
                    </div>
                </article>
            </div>
        </section>

        <section class="editor" id="editor">
            <div class="editor-header">
                <h2>Chord workspace</h2>
                <div class="editor-actions">
                    <div id="keyDetection" style="margin-right: 20px; padding: 8px 16px; background: rgba(255, 59, 92, 0.1); border: 1px solid rgba(255, 59, 92, 0.3); border-radius: 8px; display: none;">
                        <span style="color: var(--text-muted); font-size: 0.9rem;">Detected Key:</span>
                        <strong id="detectedKey" style="color: var(--primary); margin-left: 8px; font-size: 1rem;">-</strong>
                    </div>
                    <button class="ghost-button" id="saveSongButton">ðŸ’¾ Save</button>
                    <button class="ghost-button" id="loadSongButton">ðŸ“‚ Load</button>
                    <button class="ghost-button" id="updateSongButton">ðŸ”„ Update</button>
                    <button class="ghost-button" id="copyToClipboard">Copy text</button>
                </div>
            </div>
            <div id="keyAnalysis" style="margin: 20px 0; padding: 16px; background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 12px; display: none;">
                <h4 style="margin: 0 0 12px 0; color: var(--primary); font-size: 0.95rem; font-weight: 600;">ðŸŽµ Key Analysis</h4>
                <p id="keyAnalysisText" style="margin: 0; color: var(--text-muted); font-size: 0.9rem; line-height: 1.6;"></p>
            </div>
            <div class="editor-panel">
                <header class="visual-editor-header">
                    <h3>Visual Editor (edit here)</h3>
                    <div class="mini-preview" id="miniWorkspacePreview">
                        <img id="miniWorkspacePreviewImage" alt="Uploaded chart preview">
                        <span class="mini-preview-placeholder">Preview appears here after upload.</span>
                    </div>
                    <div class="reanalyze-block">
                        <label for="reanalyzeFeedback">Need a better pass? Tell the AI what to fix.</label>
                        <textarea id="reanalyzeFeedback" placeholder="Example: Verse 1 chords drift left; please align with lyrics and double-check key."></textarea>
                        <button class="ghost-button" id="reanalyzeButton" disabled>Re-analyze with feedback</button>
                    </div>
                    <small class="visual-editor-subtitle">Chords above lyrics - adjust spacing freely</small>
                </header>
                <textarea id="visualEditor" placeholder="Edit chords and lyrics with visual spacing..."></textarea>
            </div>
        </section>

        <section class="preview-section" id="previewSection">
            <div class="preview-header">
                <h2>Print Preview & Transpose</h2>
                <button class="primary-action" id="printButton">Print chart</button>
            </div>
            <div class="preview-controls-row">
                <div class="preview-controls">
                    <label class="font-size-control">
                        Font Size: <span id="fontSizeValue">10</span>pt
                        <input type="range" id="fontSizeSlider" min="8" max="14" value="10" step="0.5">
                    </label>
                    <label class="line-height-control">
                        Line Spacing: <span id="lineHeightValue">1.3</span>
                        <input type="range" id="lineHeightSlider" min="1.0" max="2.0" value="1.3" step="0.1">
                    </label>
                    <div class="transpose-controls">
                        <button class="ghost-button" data-shift="-1">â€“1</button>
                        <button class="ghost-button" data-shift="1">+1</button>
                        <label class="transpose-label">
                            Steps
                            <input type="number" id="transposeStepInput" value="0" min="-11" max="11">
                        </label>
                        <button class="ghost-button" id="applyTranspose">Apply</button>
                        <button class="ghost-button" id="resetTranspose">Reset</button>
                    </div>
                </div>
            </div>
            <div class="preview-container">
                <div id="livePreview" class="live-preview"></div>
            </div>
        </section>

        <section class="editor-workspace">
            <div class="editor-panel">
                <header>
                    <h3>SongBook Format (auto-updated)</h3>
                    <small>Copy this to SongBook app</small>
                </header>
                <textarea id="songbookOutput" readonly placeholder="SongBook format with [C] brackets will appear here..."></textarea>
            </div>
        </section>

        <section class="support-section" id="support" style="max-width: 600px; margin: 60px auto 80px; padding: 30px 20px; text-align: center;">
            <h2 style="font-size: 2rem; margin-bottom: 20px;">Support ChordsApp</h2>
            <p style="font-size: 1.1rem; color: var(--text-muted, #999); margin-bottom: 30px; line-height: 1.6;">
                ChordsApp is completely free to use. If you find it helpful for your music ministry or personal practice, please consider supporting us with a donation to help keep this project running and continually improving.
            </p>
            <div style="max-width: 400px; margin: 0 auto;">
                <div class="donation-amount-container">
                    <label for="donationAmount" class="donation-label">Donation Amount (USD)</label>
                    <input type="number" id="donationAmount" class="donation-input" placeholder="10" min="1" step="0.01" value="10">
                </div>
                <div id="paypal-button-container"></div>
            </div>
        </section>
        <section class="visualizer-promo" style="max-width: 800px; margin: 80px auto 60px; padding: 40px 30px; background: rgba(28, 27, 34, 0.65); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 20px; text-align: center;">
            <h2 style="font-size: 2rem; margin-bottom: 16px; color: var(--text);">Check Out Visualizer 1.0</h2>
            <p style="font-size: 1.1rem; color: var(--text-muted); margin-bottom: 30px; line-height: 1.6;">
                A revolutionary VST plugin that provides seamless, real-time visual feedback for your MIDI controller. Perfect for worship leaders and music producers who want complete control over their sound.
            </p>
            <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
                <a href="../index.html#features" style="background: transparent; color: var(--text); padding: 12px 28px; border-radius: 8px; border: 2px solid var(--primary); text-decoration: none; font-weight: 600; transition: all 0.3s ease; display: inline-block;">Learn More</a>
                <a href="../index.html#pricing" style="background: var(--primary); color: #fff; padding: 12px 28px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.3s ease; display: inline-block; box-shadow: 0 4px 15px rgba(255, 59, 92, 0.4);">Get Visualizer 1.0</a>
            </div>
        </section>
    </main>

    <footer class="app-footer">
        <p>&copy; <span id="year"></span> The Faith Sound. Built with love for worship leaders and musicians.</p>
    </footer>

    <!-- Hidden print-only formatted version -->
    <div id="printPreview" class="print-only" style="display: none;"></div>

    <!-- Custom Modal -->
    <div id="customModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 id="modalTitle">Modal Title</h3>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            <div class="modal-body">
                <p id="modalMessage">Modal message goes here.</p>
                <input type="number" id="modalInput" class="modal-input" placeholder="10" min="1" step="0.01" style="display: none;">
            </div>
            <div class="modal-footer">
                <button class="ghost-button" id="modalCancel">Cancel</button>
                <button class="primary-action" id="modalConfirm">OK</button>
            </div>
        </div>
    </div>

    <!-- Auth Message Display -->
    <div id="authMessage" style="position: fixed; top: 80px; right: 20px; max-width: 400px; padding: 16px 20px; border-radius: 8px; display: none; z-index: 10000; font-weight: 500;"></div>

    <!-- Authentication Modal -->
    <div id="authModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); z-index: 9999; justify-content: center; align-items: center;">
        <div style="background: var(--surface); border-radius: 20px; padding: 40px; max-width: 450px; width: 90%; position: relative; border: 1px solid rgba(255,255,255,0.1);">
            <button id="closeAuthModal" style="position: absolute; top: 20px; right: 20px; background: transparent; border: none; color: var(--text-muted); font-size: 28px; cursor: pointer; line-height: 1; padding: 0;">&times;</button>

            <!-- Login Form -->
            <div id="loginFormContainer">
                <h2 style="margin-bottom: 10px; color: var(--text); font-size: 1.8rem;">Welcome Back</h2>
                <p style="color: var(--text-muted); margin-bottom: 30px;">Sign in to continue to ChordsApp</p>

                <form id="loginForm">
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 500;">Email Address</label>
                        <input type="email" id="loginEmail" placeholder="you@example.com" required style="width: 100%; padding: 12px 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: var(--text); font-size: 1rem;">
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 500;">Password</label>
                        <input type="password" id="loginPassword" placeholder="Enter your password" required style="width: 100%; padding: 12px 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: var(--text); font-size: 1rem;">
                    </div>

                    <button type="submit" style="width: 100%; padding: 14px; background: var(--primary); color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; margin-top: 10px;">Sign In</button>

                    <button type="button" class="google-signin-btn" style="width: 100%; padding: 14px; background: white; color: #333; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; margin-top: 15px; display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M17.6 9.2l-.1-1.8H9v3.4h4.8C13.6 12 13 13 12 13.6v2.2h3a8.8 8.8 0 0 0 2.6-6.6z" fill="#4285F4"/><path d="M9 18c2.4 0 4.5-.8 6-2.2l-3-2.2a5.4 5.4 0 0 1-8-2.9H1V13a9 9 0 0 0 8 5z" fill="#34A853"/><path d="M4 10.7a5.4 5.4 0 0 1 0-3.4V5H1a9 9 0 0 0 0 8l3-2.3z" fill="#FBBC05"/><path d="M9 3.6c1.3 0 2.5.4 3.4 1.3L15 2.3A9 9 0 0 0 1 5l3 2.4a5.4 5.4 0 0 1 5-3.7z" fill="#EA4335"/></g></svg>
                        Continue with Google
                    </button>

                    <div style="text-align: center; margin-top: 20px; color: var(--text-muted);">
                        Don't have an account? <a href="#" id="switchToSignup" style="color: var(--primary); text-decoration: none; font-weight: 500;">Sign up</a>
                        <br><a href="#" id="switchToReset" style="color: var(--primary); text-decoration: none; font-weight: 500;">Forgot password?</a>
                    </div>
                </form>
            </div>

            <!-- Signup Form -->
            <div id="signupFormContainer" style="display: none;">
                <h2 style="margin-bottom: 10px; color: var(--text); font-size: 1.8rem;">Create Account</h2>
                <p style="color: var(--text-muted); margin-bottom: 30px;">Join ChordsApp community</p>

                <form id="signupForm">
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 500;">Full Name</label>
                        <input type="text" id="signupName" placeholder="John Doe" required style="width: 100%; padding: 12px 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: var(--text); font-size: 1rem;">
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 500;">Email Address</label>
                        <input type="email" id="signupEmail" placeholder="you@example.com" required style="width: 100%; padding: 12px 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: var(--text); font-size: 1rem;">
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 500;">Password</label>
                        <input type="password" id="signupPassword" placeholder="At least 6 characters" required style="width: 100%; padding: 12px 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: var(--text); font-size: 1rem;">
                    </div>

                    <button type="submit" style="width: 100%; padding: 14px; background: var(--primary); color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; margin-top: 10px;">Create Account</button>

                    <button type="button" class="google-signin-btn" style="width: 100%; padding: 14px; background: white; color: #333; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; margin-top: 15px; display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M17.6 9.2l-.1-1.8H9v3.4h4.8C13.6 12 13 13 12 13.6v2.2h3a8.8 8.8 0 0 0 2.6-6.6z" fill="#4285F4"/><path d="M9 18c2.4 0 4.5-.8 6-2.2l-3-2.2a5.4 5.4 0 0 1-8-2.9H1V13a9 9 0 0 0 8 5z" fill="#34A853"/><path d="M4 10.7a5.4 5.4 0 0 1 0-3.4V5H1a9 9 0 0 0 0 8l3-2.3z" fill="#FBBC05"/><path d="M9 3.6c1.3 0 2.5.4 3.4 1.3L15 2.3A9 9 0 0 0 1 5l3 2.4a5.4 5.4 0 0 1 5-3.7z" fill="#EA4335"/></g></svg>
                        Sign up with Google
                    </button>

                    <div style="text-align: center; margin-top: 20px; color: var(--text-muted);">
                        Already have an account? <a href="#" class="switchToLogin" style="color: var(--primary); text-decoration: none; font-weight: 500;">Sign in</a>
                    </div>
                </form>
            </div>

            <!-- Reset Password Form -->
            <div id="resetFormContainer" style="display: none;">
                <h2 style="margin-bottom: 10px; color: var(--text); font-size: 1.8rem;">Reset Password</h2>
                <p style="color: var(--text-muted); margin-bottom: 30px;">Enter your email to receive a reset link</p>

                <form id="resetForm">
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 500;">Email Address</label>
                        <input type="email" id="resetEmail" placeholder="you@example.com" required style="width: 100%; padding: 12px 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: var(--text); font-size: 1rem;">
                    </div>

                    <button type="submit" style="width: 100%; padding: 14px; background: var(--primary); color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; margin-top: 10px;">Send Reset Link</button>

                    <div style="text-align: center; margin-top: 20px; color: var(--text-muted);">
                        Remember your password? <a href="#" class="switchToLogin" style="color: var(--primary); text-decoration: none; font-weight: 500;">Sign in</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Save Song Modal -->
    <div id="saveSongModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3>ðŸ’¾ Save Song to Library</h3>
                <button class="modal-close" id="saveSongClose">&times;</button>
            </div>
            <div class="modal-body">
                <p>Enter a name for this song:</p>
                <input type="text" id="songNameInput" class="modal-input" placeholder="Song name (e.g., Amazing Grace)" style="display: block;">
            </div>
            <div class="modal-footer">
                <button class="ghost-button" id="saveSongCancel">Cancel</button>
                <button class="primary-action" id="saveSongConfirm">Save</button>
            </div>
        </div>
    </div>

    <!-- Load Song Modal -->
    <div id="loadSongModal" class="modal-overlay">
        <div class="modal-container" style="max-width: 600px;">
            <div class="modal-header">
                <h3>ðŸ“‚ Load Song from Library</h3>
                <button class="modal-close" id="loadSongClose">&times;</button>
            </div>
            <div class="modal-body">
                <p>Select a song from your library:</p>
                <div id="songList" style="max-height: 400px; overflow-y: auto; margin-top: 16px;">
                    <!-- Songs will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="ghost-button" id="loadSongCancel">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Theme Toggle -->
    <script src="theme.js"></script>

    <!-- Firebase Configuration and Auth -->
    <script src="firebase-config.js"></script>
    <script src="auth.js"></script>

    <!-- Song Library -->
    <script src="song-library.js"></script>

    <script src="app.js?v=37"></script>

    <style>
        #authMessage.success {
            background: rgba(52, 211, 153, 0.1);
            color: #34d399;
            border: 1px solid rgba(52, 211, 153, 0.3);
        }
        #authMessage.error {
            background: rgba(255, 59, 92, 0.1);
            color: var(--primary);
            border: 1px solid rgba(255, 59, 92, 0.3);
        }
        #authMessage.info {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        #profileMenu button:hover {
            background: rgba(255, 255, 255, 0.05);
        }
    </style>

    <script>
        // Custom Modal System
        const modal = {
            overlay: document.getElementById('customModal'),
            title: document.getElementById('modalTitle'),
            message: document.getElementById('modalMessage'),
            input: document.getElementById('modalInput'),
            confirmBtn: document.getElementById('modalConfirm'),
            cancelBtn: document.getElementById('modalCancel'),
            closeBtn: document.getElementById('modalClose'),

            show: function(title, message, showInput = false) {
                return new Promise((resolve, reject) => {
                    this.title.textContent = title;
                    this.message.textContent = message;
                    this.input.style.display = showInput ? 'block' : 'none';
                    if (showInput) this.input.value = '10';
                    this.overlay.style.display = 'flex';

                    const handleConfirm = () => {
                        if (showInput) {
                            const value = parseFloat(this.input.value);
                            if (!value || value <= 0) {
                                this.input.style.borderColor = 'var(--primary)';
                                setTimeout(() => {
                                    this.input.style.borderColor = '';
                                }, 500);
                                return;
                            }
                            this.close();
                            resolve(value);
                        } else {
                            this.close();
                            resolve(true);
                        }
                    };

                    const handleCancel = () => {
                        this.close();
                        resolve(null);
                    };

                    this.confirmBtn.onclick = handleConfirm;
                    this.cancelBtn.onclick = handleCancel;
                    this.closeBtn.onclick = handleCancel;
                    this.overlay.onclick = (e) => {
                        if (e.target === this.overlay) handleCancel();
                    };

                    // Enter key support
                    const handleEnter = (e) => {
                        if (e.key === 'Enter') {
                            handleConfirm();
                            document.removeEventListener('keydown', handleEnter);
                        }
                    };
                    document.addEventListener('keydown', handleEnter);
                });
            },

            close: function() {
                this.overlay.style.display = 'none';
                this.input.style.borderColor = '';
            }
        };

        // PayPal Donate Button
        const donationInput = document.getElementById('donationAmount');

        paypal.Buttons({
            createOrder: function(data, actions) {
                const amount = parseFloat(donationInput.value);

                if (!amount || amount <= 0) {
                    donationInput.style.borderColor = 'var(--primary)';
                    donationInput.focus();
                    setTimeout(() => {
                        donationInput.style.borderColor = '';
                    }, 1000);
                    return null;
                }

                return actions.order.create({
                    purchase_units: [{
                        description: 'Support ChordsApp Development',
                        amount: {
                            currency_code: 'USD',
                            value: amount.toFixed(2)
                        }
                    }]
                });
            },
            onApprove: async function(data, actions) {
                return actions.order.capture().then(async function(orderDetails) {
                    await modal.show(
                        'Thank You!',
                        'Thank you for your generous support! Your contribution helps keep ChordsApp free for everyone.'
                    );
                    console.log('Donation completed:', orderDetails);
                });
            },
            onError: async function(err) {
                console.error('PayPal error:', err);
                await modal.show(
                    'Error',
                    'There was an error processing your donation. Please try again.'
                );
            }
        }).render('#paypal-button-container');
    </script>
</body>
</html>
